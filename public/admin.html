<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Admin - VictorLJZ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
        }
        .hidden { display: none; }
        input, button {
            padding: 10px;
            margin: 5px 0;
        }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
    </style>
    <script src="config.js"></script>
</head>
<body>
    <h1>Admin Panel</h1>
    
    <div id="loginForm">
        <h3>Login</h3>
        <form id="adminLogin">
            <input type="password" id="password" placeholder="Admin password" required>
            <button type="submit">Login</button>
        </form>
        <div id="loginStatus"></div>
    </div>

    <div id="messagesSection" class="hidden">
        <h3>Messages</h3>
        <div id="messagesList"></div>
    </div>

    <script>
        const SUPABASE_URL = SUPABASE_CONFIG.url;
        const SUPABASE_KEY = SUPABASE_CONFIG.key;
        let authToken = null;

        document.getElementById('adminLogin').addEventListener('submit', async (e) => {
            e.preventDefault();
            const password = document.getElementById('password').value;
            const statusDiv = document.getElementById('loginStatus');
            try {
                const response = await fetch(`${SUPABASE_URL}/auth/v1/token?grant_type=password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'apikey': SUPABASE_KEY
                    },
                    body: JSON.stringify({
                        email: SUPABASE_CONFIG.adminEmail,
                        password: password
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    authToken = data.access_token;
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('messagesSection').classList.remove('hidden');
                    loadMessages();
                } else {
                    throw new Error('Invalid credentials');
                }
            } catch (error) {
                statusDiv.textContent = 'Login failed. Please try again.';
            }
        });

        async function loadMessages() {
            const messagesList = document.getElementById('messagesList');
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/messages?select=*`, {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                const messages = await response.json();
                messagesList.innerHTML = `
                    <table>
                        <tr><th>Message</th><th>Date</th><th>Actions</th></tr>
                        ${messages.map(msg => `
                            <tr>
                                <td>${msg.message}</td>
                                <td>${new Date(msg.created_at).toLocaleString()}</td>
                                <td><button onclick="deleteMessage('${msg.id}')">Delete</button></td>
                            </tr>
                        `).join('')}
                    </table>
                `;
            } catch (error) {
                messagesList.innerHTML = 'Error loading messages';
            }
        }

        async function deleteMessage(id) {
            try {
                const response = await fetch(`${SUPABASE_URL}/rest/v1/messages?id=eq.${id}`, {
                    method: 'DELETE',
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                if (response.ok) loadMessages();
            } catch (error) {
                alert('Error deleting message');
            }
        }
    </script>
</body>
</html> 